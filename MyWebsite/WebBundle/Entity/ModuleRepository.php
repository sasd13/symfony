<?php

namespace MyWebsite\WebBundle\Entity;

use Doctrine\ORM\EntityRepository;
use Doctrine\Common\Collections\ArrayCollection;
use MyWebsite\WebBundle\Entity\Menu;

/**
 * ModuleRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ModuleRepository extends EntityRepository
{
	public function myFindActivated()
	{
		$qb = $this->createQueryBuilder('module')
			->where('module.active = :active')
			->setParameter('active', true)
			->addOrderBy('module.priority', 'ASC')
		;
	
		$results = $qb->getQuery()->getResult();
		
		return $results;
	}
	
	public function myFindActivatedByNameWithMenusByDisplay($moduleName, $menuDisplay)
	{
		$qb = $this->createQueryBuilder('module')
			->where('module.name = :module_name')
			->setParameter('module_name', $moduleName)
			->andWhere('module.active = :module_active')
			->setParameter('module_active', true)
			->leftJoin('module.menus', 'menu')
			->addSelect('menu')
			->andWhere('menu.display = :menu_display')
			->setParameter('menu_display', $menuDisplay)
			->andWhere('menu.isRoot = :menu_isRoot')
			->setParameter('menu_isRoot', true)
			->andWhere('menu.active = :menu_active')
			->setParameter('menu_active', true)
			->leftJoin('menu.subMenus', 'subMenu')
			->addSelect('subMenu')
			->andWhere('subMenu.active = :subMenu_active')
			->setParameter('subMenu_active', true)
		;
		
		$results = $qb->getQuery()->getResult();
		
		return $results;
	}
	
	public function myFindActivatedWithMenusByDisplay($menuDisplay)
	{
		$qb = $this->createQueryBuilder('module')
			->where('module.active = :module_active')
			->setParameter('module_active', true)
			->addOrderBy('module.priority', 'ASC')
			->leftJoin('module.menus', 'menu')
			->addSelect('menu')
			->andWhere('menu.display = :menu_display')
			->setParameter('menu_display', $menuDisplay)
			->andWhere('menu.isRoot = :menu_isRoot')
			->setParameter('menu_isRoot', true)
			->andWhere('menu.active = :menu_active')
			->setParameter('menu_active', true)
			->leftJoin('menu.subMenus', 'subMenu')
			->addSelect('subMenu')
			->andWhere('subMenu.active = :subMenu_active')
			->setParameter('subMenu_active', true)
		;
		
		$results = $qb->getQuery()->getResult();
		
		return $results;
	}
}
